(()=>{"use strict";window.addEventListener("contextmenu",(t=>{t.preventDefault()}),!1);const t=document.createElement("canvas"),i=document.querySelector("body"),s=document.createElement("button"),e=document.createElement("button");t.width=t.height="470",t.textContent='Извините, ваш браузер не поддерживает "canvas" элемент.',s.textContent="Reset",e.textContent="Solve",i.append(t,s,e);const h=new class{constructor(t,i){this.canvas=t,this.ctx=t.getContext("2d"),this.size=i,this.answer=[],this.guesses=[],this.hints={rows:[],columns:[]},this.marginGrid=0,this.dividerWidth=0,this.mouse=function(t){const i={x:0,y:0,event:null};return t.addEventListener("mousemove",(s=>{const e=t.getBoundingClientRect(),{clientX:h,clientY:r}=s;i.x=h-e.left,i.y=r-e.top,i.event=s})),i}(t),t.addEventListener("mousedown",(t=>{this.onMouseDown(t),this.update()}),!1)}play(){this.generateGrid(),this.getHintsValues(),this.reset(),this.update()}generateGrid(){const t=Array(this.size*this.size).fill(0);this.guesses=Array(this.size*this.size).fill(0),this.answer=t.map((t=>Math.round(Math.random()))),this.marginGrid=100,this.dividerWidth=Math.trunc((this.canvas.width-this.marginGrid-30)/this.size),console.log(Array.from({length:this.size},((t,i)=>this.answer.slice(i*this.size,(i+1)*this.size))))}reset(t=!1){this.guesses=this.guesses.map((()=>0)),t&&this.update()}drawCell(t,i,s){this.ctx.save(),this.ctx.translate(this.marginGrid,this.marginGrid),this.ctx.fillStyle=s,this.ctx.fillRect(t,i,this.dividerWidth,this.dividerWidth),this.ctx.restore()}solve(){this.guesses=[...this.answer],this.update()}isSolved(){return this.answer.every(((t,i)=>t===this.guesses[i]))}update(){this.ctx.clearRect(0,0,this.ctx.width,this.ctx.height),this.render(),this.isSolved()&&window.setTimeout((()=>{alert("Success!"),this.play()}),500)}onMouseDown(){for(let t=0;t<this.size;t+=1)for(let i=0;i<this.size;i+=1){const s=i+t*this.size,e=this.marginGrid+i*(this.dividerWidth+this.size),h=this.marginGrid+t*(this.dividerWidth+this.size);if(this.mouse.x>=e&&this.mouse.x<=e+this.dividerWidth&&this.mouse.y>=h&&this.mouse.y<=h+this.dividerWidth)switch(event.button){case 0:this.guesses[s]=1===this.guesses[s]?0:1;break;case 2:this.guesses[s]=2===this.guesses[s]?0:2}}}render(){this.ctx.fillStyle="white",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.fillStyle="black",this.ctx.fillRect(this.marginGrid-this.size,this.marginGrid-this.size,this.dividerWidth*this.size+this.size*(this.size+1),this.dividerWidth*this.size+this.size*(this.size+1)),this.writeHorizClues(),this.writeVertClues();for(let t=0;t<this.size;t+=1)for(let i=0;i<this.size;i+=1){const s=i+t*this.size,e=(this.dividerWidth+this.size)*i,h=(this.dividerWidth+this.size)*t;0===this.guesses[s]?this.drawCell(e,h,"white"):this.drawCell(e,h,"black")}}writeHorizClues(){let t=this.marginGrid+Math.round(this.dividerWidth/2);null===this.hints.rows&&this.getHintsValues(),this.ctx.save(),this.ctx.font="bold 12px Arial";for(let i=0;i<this.hints.rows.length;i+=1)this.ctx.fillText(this.hints.rows[i],30,t),t+=this.dividerWidth+this.size;this.ctx.fillStyle="black",this.ctx.restore()}writeVertClues(){let t,i=this.marginGrid+Math.round(this.dividerWidth/4);this.ctx.save(),this.ctx.font="bold 12px Arial",this.ctx.fillStyle="black";for(let s=0;s<this.hints.columns.length;s+=1){const e=this.hints.columns[s];t=12;for(let s=0;s<e.length;s+=1)t+=10,this.ctx.fillText(e.charAt(s),i,t);i+=this.dividerWidth+this.size}this.ctx.restore()}getHintsValues(){this.hints={rows:[],columns:[]};for(let t=0;t<this.size;t+=1){let i="",s=0,e=t*this.size;for(let h=1;h<this.size-1;h+=1){for(s=0;0===this.answer[e]&&e<this.size+t*this.size;)e++;for(;1===this.answer[e]&&e<this.size+t*this.size;)s+=1,e++;if(s&&(i+=`${s}  `),e>=this.size+t*this.size)break}""===i&&(i="0"),this.hints.rows.push(i)}for(let t=0;t<this.size;t+=1){let i=0,s=t,e="";for(let h=1;h<4;h+=1){for(i=0;0===this.answer[s]&&s<t+this.size*this.size;)s+=this.size;for(;1===this.answer[s]&&s<t+this.size*this.size;)i+=1,s+=this.size;if(i&&(e+=`${i}  `),s>=t+this.size*this.size)break}""===e&&(e="0"),this.hints.columns.push(e)}}}(t,5);h.play(),e.addEventListener("click",(()=>{h.solve()})),s.addEventListener("click",(()=>{h.reset(!0)}))})();